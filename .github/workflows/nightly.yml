name: Update Version Nightly
on:
  workflow_dispatch:
    inputs: {}
  schedule:
    - cron: '0 0 * * *' # Run at 0 AM UTC

jobs:
  update-version:
    permissions: write-all
    name: Update Version Nightly
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Check V8 version
      run: |
        cd $GITHUB_WORKSPACE
        yarn install
        node ./.github/workflows/version.js
    - name: Commit & Push changes
      uses: actions-x/commit@v6
      with:
        branch: main
        token: ${{ secrets.GITHUB_TOKEN }}
        message: Update V8 version

  build:
    name: Dispatch build and release
    runs-on: ubuntu-latest
    needs: update-version
    env:
      PERSONAL_TOKEN: ${{ secrets.ACCESS_TOKEN }}
    steps:
      - run: |
          echo "${{ secrets.GITHUB_TOKEN }}"
          echo "${{ secrets.ACCESS_TOKEN }}"
      - name: Start build for linux
        uses: benc-uk/workflow-dispatch@v1
        with:
          workflow: üêß Linux Builds
          token: ${{ secrets.ACCESS_TOKEN }}
